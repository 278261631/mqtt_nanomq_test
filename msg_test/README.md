# MQTT 消息测试工具

本目录包含三个Python脚本，用于测试MQTT服务器的消息收发功能。

## 脚本说明

### 1. mqtt_subscriber.py
MQTT订阅者脚本，用于连接到MQTT服务器并订阅指定主题，接收和显示消息。

**功能：**
- 连接到指定的MQTT服务器
- 订阅指定主题
- 实时显示收到的消息
- 支持QoS 1消息级别

### 2. mqtt_publisher.py
MQTT发布者脚本，用于连接到MQTT服务器并发布消息到指定主题。

**功能：**
- 连接到指定的MQTT服务器
- 发布随机测试消息
- 每秒发布一条消息
- 支持QoS 1消息级别
- 显示发布状态

### 3. mqtt_test.py
综合测试脚本，同时运行订阅者和发布者，自动测试消息收发功能。

**功能：**
- 自动启动订阅者线程
- 自动发布5条测试消息
- 统计消息收发成功率
- 显示详细的测试结果
- 支持QoS 1消息级别

## 配置信息

所有脚本使用以下配置（可在脚本中修改）：

| 参数 | 值 |
|------|-----|
| MQTT Broker | localhost |
| 端口 | 11883 |
| 用户名 | mqtt_user |
| 密码 | mqtt_pass |
| 测试主题 | test/topic |
| QoS级别 | 1 |

## 安装依赖

运行脚本前需要安装paho-mqtt库：

```bash
pip install paho-mqtt
```

## 使用方法

### 方法1：分别运行发布者和订阅者

1. 启动订阅者（在第一个终端）：
   ```bash
   python mqtt_subscriber.py
   ```

2. 启动发布者（在第二个终端）：
   ```bash
   python mqtt_publisher.py
   ```

3. 观察订阅者终端接收的消息

4. 按Ctrl+C停止脚本

### 方法2：使用综合测试脚本

```bash
python mqtt_test.py
```

该脚本会自动：
- 启动订阅者线程
- 发布5条测试消息
- 显示详细的测试结果

## 示例输出

### 订阅者输出
```
🚀 MQTT订阅者启动
📡 连接到: localhost:11883
👤 用户名: mqtt_user
📝 订阅主题: test/topic
==================================================
✅ 成功连接到MQTT服务器: localhost:11883
📋 已订阅主题: test/topic
📥 收到消息:
   主题: test/topic
   内容: 测试消息 #0 - 随机数: 42
   QoS: 1
--------------------------------------------------
```

### 发布者输出
```
🚀 MQTT发布者启动
📡 连接到: localhost:11883
👤 用户名: mqtt_user
📝 发布主题: test/topic
==================================================
✅ 成功连接到MQTT服务器: localhost:11883
📢 开始发布测试消息...
💡 输入'quit'退出，或按Enter键发布随机消息
--------------------------------------------------

📤 消息发布成功，消息ID: 1
📝 已发布:
   主题: test/topic
   内容: 测试消息 #0 - 随机数: 42
   QoS: 1
--------------------------------------------------
```

### 综合测试输出
```
🚀 MQTT综合测试工具
📡 MQTT服务器: localhost:11883
👤 用户名: mqtt_user
📝 测试主题: test/topic
============================================================
✅ 订阅者成功连接到MQTT服务器: localhost:11883
📋 订阅者已订阅主题: test/topic
✅ 发布者成功连接到MQTT服务器: localhost:11883
⏳ 等待订阅者连接...

📢 开始发布测试消息...
💡 将连续发布5条消息，每条间隔2秒
------------------------------------------------------------

📤 发布者消息发布成功，消息ID: 1
📝 发布者已发布消息 #1:
   主题: test/topic
   内容: 综合测试消息 #1 - 14:30:45
   QoS: 1
------------------------------------------------------------
📥 订阅者收到消息 #1:
   主题: test/topic
   内容: 综合测试消息 #1 - 14:30:45
   QoS: 1
------------------------------------------------------------

...

🎉 测试完成!
📊 发布消息数: 5
📊 接收消息数: 5
📊 消息成功率: 5/5
✅ 所有消息均已成功接收!

📴 测试工具已退出
```

## 注意事项

1. 确保MQTT服务器已启动并运行在11883端口
2. 确保用户名和密码正确
3. 确保网络连接正常
4. 脚本支持Python 3.6及以上版本
5. 按Ctrl+C可停止脚本运行

## 故障排除

- **连接失败**：检查MQTT服务器是否运行，端口是否正确
- **认证失败**：检查用户名和密码是否正确
- **消息丢失**：检查网络连接，或尝试调整QoS级别
- **无响应**：检查脚本是否有语法错误，或依赖是否安装正确

## 修改配置

如需修改MQTT服务器配置，可编辑脚本中的以下变量：

```python
# MQTT服务器配置
MQTT_BROKER = "localhost"
MQTT_PORT = 11883
MQTT_USERNAME = "mqtt_user"
MQTT_PASSWORD = "mqtt_pass"
MQTT_TOPIC = "test/topic"
```

## 许可证

本脚本采用MIT许可证，可自由使用和修改。
